(()=>{"use strict";const e=document.querySelector(".playerboard"),t=document.querySelector(".enemyboard"),o=document.querySelector(".textfield");let r;function s(e){r=e}function a(e){for(let t=0;t<100;t++){const o=document.createElement("div"),s=[t%10,Math.floor(t/10)];o.classList.add("box"),o.classList.add(`box${t%10}${Math.floor(t/10)}`),o.addEventListener("click",(()=>{r(s,!1)})),o.addEventListener("contextmenu",(e=>{e.preventDefault(),r(s,!0)})),e.appendChild(o)}!function(e){const t=e.querySelector(".xcoords"),o=e.querySelector(".ycoords");for(let e=1;e<=10;e++){const r=document.createElement("div");r.classList.add("coord");const s=document.createElement("p");s.textContent=`${e}`,r.appendChild(s),t.appendChild(r);const a=document.createElement("div");a.classList.add("coord");const n=document.createElement("p");n.textContent=String.fromCharCode(64+e),a.appendChild(n),o.appendChild(a)}}(e)}function n([e,t],o,r){const s=document.createElement("div"),a=r.querySelector(`.box${e}${t}`);s.classList.add(o),a.insertBefore(s,a.children[0])}function i(e){o.innerText=e}const c={patrol:2,submarine:3,destroyer:3,battleship:4,carrier:5};class l{constructor(e){this.type=e,this.length=c[e],this.hits=0,this.hasSunk=!1}hit(){this.hits++}isSunk(){return this.hits>=this.length}}class d{constructor(){this.ships=0}placeShip(e,t,o,r){const s=new l(r);if(o)for(let o=0;o<s.length;o++){if(!(void 0===this[`${e+o}, ${t}`]&&e+o<=9)){for(let r=0;r<o;r++)this[`${e+r}, ${t}`]=void 0;return console.log("ships overlap or overflow")}this[`${e+o}, ${t}`]=s}else for(let o=0;o<s.length;o++){if(!(void 0===this[`${e}, ${t+o}`]&&t+o<=9)){for(let r=0;r<o;r++)this[`${e}, ${t+r}`]=void 0;return console.log("ships overlap or overflow")}this[`${e}, ${t+o}`]=s}return this.ships++,"ok"}receiveAttack([e,t]){return"object"==typeof this[`${e}, ${t}`]?(this[`${e}, ${t}`].hit(),this[`${e}, ${t}`].isSunk()&&this.ships--,this[`${e}, ${t}`]="hit","hit"):this[`${e}, ${t}`]="miss"}shipsLeft(){return this.ships}}class h{constructor(e){this.type=e,this.moves=[]}takeTurn(e=Math.floor(10*Math.random()),t=Math.floor(10*Math.random())){return"computer"===this.type?this.moves.reduce(((o,r)=>r[0]===e&&r[1]===t||o),!1)?this.takeTurn():(this.moves.push([e,t]),[e,t]):"human"===this.type?this.moves.reduce(((o,r)=>r[0]===e&&r[1]===t||o),!1)?console.log("invalid, already played"):(this.moves.push([e,t]),[e,t]):void 0}}const u=new h("human"),m=new h("computer");u.gameBoard=new d,m.gameBoard=new d;let p=!1;const f=["patrol","submarine","destroyer","battleship","carrier"];function $([e,t]){let o="miss",r="miss",a=u.takeTurn(e,t);if("object"==typeof a&&(r=m.gameBoard.receiveAttack(a),n(a,r,document.querySelector(".enemyboard")),0===m.gameBoard.shipsLeft()&&(p=!0,i("You won"),s((()=>0))),"miss"===r)){let e=m.takeTurn();for(o=u.gameBoard.receiveAttack(e),n(e,o,document.querySelector(".playerboard"));"hit"===o;){let t=Math.random()>.5;e=e[0]>0&&e[0]<9&&t?m.takeTurn(e[0]+=Math.random()>.5?-1:1,e[1]):e[1]>0&&e[1]<9&&!t?m.takeTurn(e[0],e[1]+=Math.random()>.5?-1:1):m.takeTurn(),o=u.gameBoard.receiveAttack(e),n(e,o,document.querySelector(".playerboard"))}0===u.gameBoard.shipsLeft()&&(p=!0,i("Enemy won"),s((()=>0)))}}a(e),a(t),function(){for(let e=0;e<5;e++){let t,o,r,s=Math.random()>=.5;do{t=Math.floor(10*Math.random()),o=Math.floor(10*Math.random()),r=m.gameBoard.placeShip(t,o,s,f[e])}while("ok"!==r)}}(),s((function([e,t],o){let r=u.gameBoard.shipsLeft();"ok"===u.gameBoard.placeShip(e,t,o,f[r])&&(function([e,t],o,r,s){const a=document.createElement("div"),n=s.querySelector(`.box${e}${t}`);a.classList.add("ship"),a.classList.add(r),o&&a.classList.add("horizontal"),n.appendChild(a)}([e,t],o,f[r],document.querySelector(".playerboard")),i(`place ${f[r+1]}`),r>3&&(s($),i("game started")))})),i(`place ${f[0]}, click left for vertical, click right for horizontal`)})();